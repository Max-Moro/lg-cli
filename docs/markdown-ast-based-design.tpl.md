# Расширение Markdown-адаптера LG с использованием AST-based подхода

## Концепция расширения

Требуется расширить возможности Markdown-адаптера, добавив поддержку условных конструкций на базе HTML-комментариев. Это позволит использовать адаптивные возможности в обычных Markdown-документах без нарушения их читабельности в сторонних просмотрщиках.

### Ключевые особенности дизайна:

1. Использование **HTML-комментариев** вместо синтаксиса `{% ... %}` для скрытия LG-инструкций
2. Поддержка тех же условных операторов, что и в основном шаблонизаторе
3. Сохранение совместимости с существующими функциями Markdown-адаптера
4. AST-based подход для корректной обработки вложенных конструкций

## Синтаксис условных конструкций

Синтаксис основан на специальных HTML-комментариях с префиксами, указывающими на их роль:

### Условные блоки

```markdown
<!-- lg:if tag:python -->
Этот текст будет видим только при активном теге python.
<!-- lg:endif -->

<!-- lg:if tag:debug -->
Отладочная информация
<!-- lg:else -->
Обычное содержимое
<!-- lg:endif -->

<!-- lg:if TAGSET:language:typescript -->
TypeScript-специфичный контент
<!-- lg:elif TAGSET:language:python -->
Python-специфичный контент
<!-- lg:else -->
Контент для других языков
<!-- lg:endif -->
```

### Комментарии-инструкции

```markdown
<!-- lg:comment:start -->
Этот текст БУДЕТ ВИДИМ в Markdown-просмотрщиках,
но исключится при обработке LG-инструментом.
<!-- lg:comment:end -->
```

## Пример использования

### Конфигурация в YAML

```yaml
docs:
  extensions: [".md"]
  markdown:
    max_heading_level: 2
    enable_templating: true  # Включение новой функциональности
    drop:
      sections:
        - match: { kind: text, pattern: "Installation" }
      frontmatter: true
```

### Пример Markdown-документа с условиями

~~~markdown
# Документация API

## Введение

Это общая документация API.

<!-- lg:if tag:python -->
## Python-клиент

```python
import api_client

client = api_client.Client("apikey")
response = client.get_data()
```
<!-- lg:endif -->

<!-- lg:if tag:javascript -->
## JavaScript-клиент

```javascript
const client = new ApiClient("apikey");
const response = await client.getData();
```
<!-- lg:endif -->

<!-- lg:if tag:debug -->
## Отладка

Информация для отладки...
<!-- lg:else -->
## Использование

Стандартная инструкция по использованию...
<!-- lg:endif -->


<!-- lg:comment:start -->
TODO: Добавить документацию по новым методам API
Эта заметка не попадет в итоговый результат
<!-- lg:comment:end -->
~~~

## Особенности интеграции

1. **Порядок обработки**: Шаблонизация выполняется до обработки удаления секций и нормализации заголовков, что позволяет условно исключать целые разделы документа.

2. **Совместимость с существующим функционалом**: Адаптер сохраняет все текущие возможности, новый функционал добавляется опционально через `enable_templating`.

3. **Переиспользование оценщика условий**: Система использует существующий оценщик условий из основного шаблонизатора, обеспечивая единообразие поведения (`self.template_ctx.evaluate_condition_text(node.condition_text)`).

4. **Сохранение валидности Markdown**: Условные конструкции оформляются как HTML-комментарии, документ остаётся валидным Markdown для любых просмотрщиков.

