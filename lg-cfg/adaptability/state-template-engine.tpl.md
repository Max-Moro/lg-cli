# Дорожная карта LG V2: поэтапная разработка

## Этап 1: [+] Фундамент, новая IR-модель и конфигурация адаптивных возможностей


## Этап 2: Движок шаблонизации

- **Задача 2.1**: Разработать структуру AST для шаблонов в `lg/template/nodes.py`
  - Определить иерархию классов узлов шаблона
  - Включить поддержку всех запланированных типов узлов

- **Задача 2.2**: Реализовать лексический анализатор в `lg/template/lexer.py`
  - Создать токенизатор для исходного текста шаблона
  - Добавить обработку всех необходимых токенов

- **Задача 2.3**: Создать парсер шаблонов в `lg/template/parser.py`
  - Разработать рекурсивный парсер для преобразования потока токенов в AST
  - Обеспечить корректную обработку вложенных конструкций

- **Задача 2.4**: Разработать модуль для вычисления условий `lg/template/evaluator.py`
  - Реализовать интерпретатор для условных выражений
  - Интегрировать с системой тегов и режимов

- **Задача 2.5**: Создать контекст рендеринга шаблона `lg/template/context.py`
  - Реализовать управление состоянием при обработке шаблона
  - Обеспечить корректную работу с вложенными режимами

- **Задача 2.6**: Разработать публичный API в `lg/template/processor.py`
  - Объединить все компоненты в единый процессор шаблонов
  - Предоставить удобный интерфейс для внешних модулей

## Этап 3: Обработчик секций

- **Задача 3.1**: Создать новый модуль `lg/section_processor.py`
  - Реализовать функциональность обработки отдельных секций по запросу
  - Интегрировать с существующими системами манифестов и планирования

- **Задача 3.2**: Адаптировать работу с фильтрацией файлов
  - Переработать механизм фильтрации для использования активных тегов и режимов
  - Обеспечить совместимость с существующей системой фильтров

- **Задача 3.3**: Интегрировать с языковыми адаптерами
  - Адаптировать существующие языковые адаптеры для работы с новым обработчиком секций
  - Обеспечить совместимость настроек адаптеров с новой моделью

- **Задача 3.4**: Реализовать систему кэширования для секций
  - Создать механизм кэширования с учетом активных режимов и тегов
  - Обеспечить эффективное использование существующего кэша

## Этап 4: Система сбора статистики

- **Задача 4.1**: Создать инкрементальный коллектор статистики
  - Реализовать базовые функции в `lg/stats/collector.py`
  - Обеспечить корректный сбор метрик во время рендеринга

- **Задача 4.2**: Интегрировать коллектор с процессором шаблонов и обработчиком секций
  - Добавить точки сбора статистики в ключевых местах обработки
  - Обеспечить сбор метаданных и токенов

- **Задача 4.3**: Реализовать формирование финального отчета
  - Создать функции преобразования собранных данных в формат API
  - Обеспечить обратную совместимость с форматом отчетов v4

## Этап 5: Новый пайплайн и интеграция

- **Задача 5.1**: Реализовать новую версию движка в `lg/engine_v2.py`
  - Создать основные функции для координации компонентов

- **Задача 5.2**: Интегрировать новый движок с CLI

## Этап 6: Тестирование, отладка и документация
