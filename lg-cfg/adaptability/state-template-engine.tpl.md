# Дорожная карта LG V2: поэтапная разработка

## Этап 1: [+] Фундамент, новая IR-модель и конфигурация адаптивных возможностей

## Этап 2: [+] Движок шаблонизации

## Этап 3: Обработчик секций

- **Задача 3.1**: Создать новый модуль `lg/section_processor.py`
  - Реализовать функциональность обработки отдельных секций по запросу
  - Интегрировать с существующими системами манифестов и планирования

- **Задача 3.2**: Адаптировать работу с фильтрацией файлов
  - Переработать механизм фильтрации для использования активных тегов и режимов
  - Обеспечить совместимость с существующей системой фильтров

- **Задача 3.3**: Интегрировать с языковыми адаптерами
  - Адаптировать существующие языковые адаптеры для работы с новым обработчиком секций
  - Обеспечить совместимость настроек адаптеров с новой моделью

- **Задача 3.4**: Реализовать систему кэширования для секций
  - Создать механизм кэширования с учетом активных режимов и тегов
  - Обеспечить эффективное использование существующего кэша

## Этап 4: Система сбора статистики

- **Задача 4.1**: Создать инкрементальный коллектор статистики
  - Реализовать базовые функции в `lg/stats/collector.py`
  - Обеспечить корректный сбор метрик во время рендеринга

- **Задача 4.2**: Интегрировать коллектор с процессором шаблонов и обработчиком секций
  - Добавить точки сбора статистики в ключевых местах обработки
  - Обеспечить сбор метаданных и токенов

- **Задача 4.3**: Реализовать формирование финального отчета
  - Создать функции преобразования собранных данных в формат API
  - Обеспечить обратную совместимость с форматом отчетов v4

- **Задача 4.4**: Прибраться в новой IR-модели
  - Оставить статистические данные только в нужных датаклассах

## Этап 5: Новый пайплайн и интеграция

- **Задача 5.1**: Реализовать новую версию движка в `lg/engine_v2.py`
  - Создать основные функции для координации компонентов

- **Задача 5.2**: Интегрировать новый движок с CLI

## Этап 6: Тестирование, отладка и документация
