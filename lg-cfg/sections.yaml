tags:
  tag-sets:
    basic-functions:
      title: "Basic functions"
      tags:
        cli:
          title: "CLI"
        diag:
          title: "Self-diagnosis"
        migrate:
          title: "Configuration migration"
        scaffold:
          title: "Configuration presets"

src:
  extends: ["tags"]
  extensions: [".py", ".toml"]
  filters:
    mode: allow
    allow:
      - "/pyproject.toml"
      - "/lg/"
    children:
      lg:
        mode: allow
        allow:
          - "/cli.py"
          - "/engine.py"
          - "/types.py"
          - "/run_context.py"
          - "/template/context.py"
          - "/section_processor.py"
          - "/section/"
        when:
          - condition: "TAGSET:basic-functions:diag"
            allow: ["/diag/"]
          - condition: "TAGSET:basic-functions:migrate"
            allow: ["/migrate/"]
          - condition: "TAGSET:basic-functions:scaffold"
            allow:
              - "/scaffold.py"
              - "/_skeletons/"
        children:
          section:
            mode: allow
            allow: ["/service.py"]

tests:
  extends: ["tags"]
  extensions: [".py"]
  filters:
    mode: allow
    allow:
      - "/tests/"
    children:
      tests:
        mode: allow
        when:
          - condition: "tag:tests-infra"
            allow:
              - "/conftest.py"
              - "/infrastructure/"
          - condition: "TAGSET:basic-functions:cli"
            allow:
              - "test_cli_minimum.py"
              - "test_cli_context.py"
          - condition: "TAGSET:basic-functions:diag"
            allow: ["/test_diag_rebuild_cache.py"]
  tag-sets:
    code-type:
      title: "Code Type"
      tags:
        tests-infra:
          title: "Test infrastructure"

review:
  extensions: [".py", ".toml"]
  filters:
    mode: block
