# Add Profile Validation to LanguageCodeDescriptor

## Problem

`LanguageCodeDescriptor` does not validate profiles:
- No check for duplicate profile names (can cause confusion in metrics)
- No check for valid Tree-sitter queries (fails at runtime)
- No check for existing `parent_profile` references

## Target File

`lg/adapters/shared/descriptor.py`

## Implementation

Add `validate()` method to `LanguageCodeDescriptor`:

```python
from typing import Set
import logging

logger = logging.getLogger(__name__)


@dataclass
class LanguageCodeDescriptor:
    # ... existing fields ...

    _validated: bool = field(default=False, repr=False)

    def validate(self) -> list[str]:
        """
        Validate descriptor configuration.

        Returns:
            List of validation errors (empty if valid)
        """
        errors = []

        # Check for duplicate profile names (warning, not error)
        seen_names: Set[str] = set()
        for profile in self.profiles:
            if profile.name in seen_names:
                # Duplicates are allowed (e.g., multiple "variable" profiles)
                # but log for awareness
                logger.debug(
                    f"{self.language}: multiple profiles with name '{profile.name}'"
                )
            seen_names.add(profile.name)

        # Check parent_profile references
        profile_names = {p.name for p in self.profiles}
        for profile in self.profiles:
            if profile.parent_profile and profile.parent_profile not in profile_names:
                errors.append(
                    f"Profile '{profile.name}' references unknown parent '{profile.parent_profile}'"
                )

        # Check query syntax (basic check)
        for profile in self.profiles:
            if not profile.query or not profile.query.strip():
                errors.append(f"Profile '{profile.name}' has empty query")
            elif "@element" not in profile.query:
                errors.append(
                    f"Profile '{profile.name}' query missing @element capture"
                )

        self._validated = True
        return errors

    def get_profiles(self) -> List[ElementProfile]:
        """
        Get resolved profiles with inheritance applied.
        Validates on first access.
        """
        if not self._validated:
            errors = self.validate()
            if errors:
                raise ValueError(
                    f"Invalid {self.language} descriptor: {'; '.join(errors)}"
                )

        if self._resolved_profiles is None:
            self._resolved_profiles = self._resolve_inheritance()
        return self._resolved_profiles
```

## Optional: Query Syntax Validation

For deeper validation, can add Tree-sitter query syntax check:

```python
def _validate_query_syntax(self, profile: ElementProfile) -> list[str]:
    """Validate Tree-sitter query syntax."""
    errors = []
    try:
        # This requires language to be available
        # May be too expensive for startup validation
        from tree_sitter import Query
        Query(self._get_language(), profile.query)
    except Exception as e:
        errors.append(f"Profile '{profile.name}' invalid query: {e}")
    return errors
```

Note: Full query validation requires Language instance, which may not be available at descriptor construction time. Consider lazy validation on first use.

## Testing

Add test in `tests/adapters/test_descriptor_validation.py`:

```python
def test_duplicate_parent_profile_error():
    descriptor = LanguageCodeDescriptor(
        language="test",
        profiles=[
            ElementProfile(name="child", query="(x) @element", parent_profile="nonexistent")
        ]
    )
    errors = descriptor.validate()
    assert any("nonexistent" in e for e in errors)


def test_empty_query_error():
    descriptor = LanguageCodeDescriptor(
        language="test",
        profiles=[
            ElementProfile(name="empty", query="")
        ]
    )
    errors = descriptor.validate()
    assert any("empty query" in e for e in errors)


def test_missing_capture_error():
    descriptor = LanguageCodeDescriptor(
        language="test",
        profiles=[
            ElementProfile(name="bad", query="(function_definition)")
        ]
    )
    errors = descriptor.validate()
    assert any("@element" in e for e in errors)
```
