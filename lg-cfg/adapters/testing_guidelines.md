# Рекомендации по тестированию при итеративном рефакторинге Literal Optimization

## Базовый инструмент
- Использовать `./scripts/test_adapters.sh` (работает по оптимизациям и языкам, обновление голденов опционально).
- Ключи: `OPTIMIZATIONS` (`literals` группирует все literal*), `LANGUAGES`, `UPDATE_GOLDENS` (`true|false`).

## Режимы запуска
- Все языки, literals (без обновления голденов):  
  `./scripts/test_adapters.sh literals all`
- Точечно по языкам (минимум при каждом крупном шаге дорожной карты):  
  `./scripts/test_adapters.sh literals java,scala,go`
- Перегенерация голденов (только для локальной диагностики, после — откатывать):  
  `./scripts/test_adapters.sh literals rust true`

## Политика работы с голденами
- Цель — нулевые расхождения: любые изменения в голденах считаются регрессией, их нужно устранять.
- Если требуется посмотреть расхождения: временно запустить с `literals all true`, затем сравнить `git diff` и откатить изменения голденов.

## Порядок проверки по этапам дорожной карты
1) После миграции дескриптора (этап 1): прогон `literals all` — проверка, что все языки собираются на новой конфигурации.
2) После ввода `processing/pipeline.py` и выноса parser/selector/formatter (этапы 2–5):  
   - сначала `literals all`;  
   - при падениях — сузить до проблемного языка: `./scripts/test_adapters.sh literals <lang>`.
3) При добавлении каждого компонента (interpolation, ast_sequence, block_init, placeholder/comment, budgeting):  
   - прогон `literals all`;  
   - если компонент затрагивает конкретные языки (например, block_init → java,rust), дополнительно запустить точечно эти языки.
4) После удаления `core.py`/`handler.py` и чистки хаков: полный `literals all`.

## Диагностика и временные шаги
- При сложных падениях не трогать реальные голдены: писать временные тесты без голден-инфраструктуры с подробным логированием, либо временно добавлять логирование в продуктовый код и убирать после фикса.
- Разрешено подсмотреть старую реализацию v1 для локализации регрессии, но итоговое решение должно соответствовать новой архитектуре.

## Быстрые проверки перед пушем
- Минимум: `./scripts/test_adapters.sh literals all`.
- При правках в одном языке: `./scripts/test_adapters.sh literals <lang>`.

## Форматирование вывода
- Скрипт сам печатает список тестовых файлов; использовать это для быстрой фильтрации проблемных тестов.

