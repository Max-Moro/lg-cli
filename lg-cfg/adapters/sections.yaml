tags:
  tag-sets:
    language:
      title: "Programming Languages"
      tags:
        none:
          title: "None"
        python:
          title: "Python"
        typescript:
          title: "TypeScript"
        kotlin:
          title: "Kotlin"
        javascript:
          title: "JavaScript"
        java:
          title: "Java"
        c:
          title: "C"
        cpp:
          title: "Cpp"
        go:
          title: "Go"
        rust:
          title: "Rust"
        scala:
          title: "Scala"

    adapters-optimizations:
      title: "Adapters optimizations"
      tags:
        core:
          title: "Core"
        function-bodies:
          title: "Function body optimization"
        comments:
          title: "Comment optimization"
        literals:
          title: "Literal optimization"
        imports:
          title: "Import optimization"
        public-api:
          title: "Public API optimization"
        budget:
          title: "Budget System"
        trivial:
          title: "Skipping trivial files"

src:
  extends: ["tags"]
  extensions: [".py", ".toml"]
  filters:
    mode: allow
    allow:
      - "/pyproject.toml"
      - "/lg/adapters/"
    children:
      lg/adapters:
        mode: allow
        allow:
          - "/__init__.py"
          - "/registry.py"
          - "/base.py"
          - "/processor.py"
          - "/context.py"
          - "/code_model.py"
          - "/code_base.py"
          - "/comment_style.py"
          - "/optimizations/"
          - "/langs/"
        when:
          - condition: "TAGSET:adapters-optimizations:core"
            allow:
              - "/tree_sitter_support.py"
              - "/range_edits.py"
              - "/placeholders.py"
              - "/metrics.py"
          - condition: "TAGSET:adapters-optimizations:budget"
            allow: ["/budget.py"]
          - condition: "TAGSET:adapters-optimizations:function-bodies OR TAGSET:adapters-optimizations:public-api"
            allow: ["/shared/"]
        children:
          optimizations:
            mode: allow
            when:
              - condition: "TAGSET:adapters-optimizations:function-bodies"
                allow: ["/function_bodies/"]
              - condition: "TAGSET:adapters-optimizations:comments"
                allow: ["/comments/"]
              - condition: "TAGSET:adapters-optimizations:literals"
                allow: ["/literals/"]
              - condition: "TAGSET:adapters-optimizations:imports"
                allow: ["/imports/"]
              - condition: "TAGSET:adapters-optimizations:public-api"
                allow: ["/public_api/"]
              - condition: "TAGSET:adapters-optimizations:trivial"
                allow: ["/trivial_files/"]
          langs:
            mode: allow
            when:
            - condition: "TAGSET:language:python"
              allow: ["/python/"]
            - condition: "TAGSET:language:typescript"
              allow: ["/typescript/"]
            - condition: "TAGSET:language:kotlin"
              allow: ["/kotlin/"]
            - condition: "TAGSET:language:javascript"
              allow: ["/javascript/"]
            - condition: "TAGSET:language:java"
              allow: ["/java/"]
            - condition: "TAGSET:language:c"
              allow: ["/c/"]
            - condition: "TAGSET:language:cpp"
              allow: ["/cpp/"]
            - condition: "TAGSET:language:go"
              allow: ["/go/"]
            - condition: "TAGSET:language:rust"
              allow: ["/rust/"]
            - condition: "TAGSET:language:scala"
              allow: ["/scala/"]
            children:
              python:
                mode: allow
                allow:
                  - "/__init__.py"
                  - "/adapter.py"
                when:
                  - condition: "TAGSET:adapters-optimizations:function-bodies OR TAGSET:adapters-optimizations:public-api"
                    allow: ["/code_profiles.py"]
                  - condition: "TAGSET:adapters-optimizations:comments"
                    allow: ["/comments.py"]
                  - condition: "TAGSET:adapters-optimizations:imports"
                    allow: ["/imports.py"]
                  - condition: "TAGSET:adapters-optimizations:literals"
                    allow: ["/literals*.py"]
                  - condition: "TAGSET:adapters-optimizations:trivial"
                    allow: ["/trivial.py"]
              typescript:
                mode: allow
                allow:
                  - "/__init__.py"
                  - "/adapter.py"
                when:
                  - condition: "TAGSET:adapters-optimizations:function-bodies OR TAGSET:adapters-optimizations:public-api"
                    allow: ["/code_profiles.py"]
                  - condition: "TAGSET:adapters-optimizations:comments"
                    allow: ["/comments.py"]
                  - condition: "TAGSET:adapters-optimizations:imports"
                    allow: ["/imports.py"]
                  - condition: "TAGSET:adapters-optimizations:literals"
                    allow: ["/literals*.py"]
                  - condition: "TAGSET:adapters-optimizations:trivial"
                    allow: ["/trivial.py"]
              kotlin:
                mode: allow
                allow:
                  - "/__init__.py"
                  - "/adapter.py"
                when:
                  - condition: "TAGSET:adapters-optimizations:function-bodies OR TAGSET:adapters-optimizations:public-api"
                    allow: ["/code_profiles.py"]
                  - condition: "TAGSET:adapters-optimizations:comments"
                    allow: ["/comments.py"]
                  - condition: "TAGSET:adapters-optimizations:imports"
                    allow: ["/imports.py"]
                  - condition: "TAGSET:adapters-optimizations:literals"
                    allow: ["/literals*.py"]
                  - condition: "TAGSET:adapters-optimizations:trivial"
                    allow: ["/trivial.py"]
              javascript:
                mode: allow
                allow:
                  - "/__init__.py"
                  - "/adapter.py"
                when:
                  - condition: "TAGSET:adapters-optimizations:function-bodies OR TAGSET:adapters-optimizations:public-api"
                    allow: ["/code_profiles.py"]
                  - condition: "TAGSET:adapters-optimizations:comments"
                    allow: ["/comments.py"]
                  - condition: "TAGSET:adapters-optimizations:imports"
                    allow: ["/imports.py"]
                  - condition: "TAGSET:adapters-optimizations:literals"
                    allow: ["/literals*.py"]
                  - condition: "TAGSET:adapters-optimizations:trivial"
                    allow: ["/trivial.py"]
              java:
                mode: allow
                allow:
                  - "/__init__.py"
                  - "/adapter.py"
                when:
                  - condition: "TAGSET:adapters-optimizations:function-bodies OR TAGSET:adapters-optimizations:public-api"
                    allow: ["/code_profiles.py"]
                  - condition: "TAGSET:adapters-optimizations:comments"
                    allow: ["/comments.py"]
                  - condition: "TAGSET:adapters-optimizations:imports"
                    allow: ["/imports.py"]
                  - condition: "TAGSET:adapters-optimizations:literals"
                    allow: ["/literals*.py"]
                  - condition: "TAGSET:adapters-optimizations:trivial"
                    allow: ["/trivial.py"]
              c:
                mode: allow
                allow:
                  - "/__init__.py"
                  - "/adapter.py"
                when:
                  - condition: "TAGSET:adapters-optimizations:function-bodies OR TAGSET:adapters-optimizations:public-api"
                    allow: ["/code_profiles.py"]
                  - condition: "TAGSET:adapters-optimizations:comments"
                    allow: ["/comments.py"]
                  - condition: "TAGSET:adapters-optimizations:imports"
                    allow: ["/imports.py"]
                  - condition: "TAGSET:adapters-optimizations:literals"
                    allow: ["/literals*.py"]
                  - condition: "TAGSET:adapters-optimizations:trivial"
                    allow: ["/trivial.py"]
              cpp:
                mode: allow
                allow:
                  - "/__init__.py"
                  - "/adapter.py"
                when:
                  - condition: "TAGSET:adapters-optimizations:function-bodies OR TAGSET:adapters-optimizations:public-api"
                    allow: ["/code_profiles.py"]
                  - condition: "TAGSET:adapters-optimizations:comments"
                    allow: ["/comments.py"]
                  - condition: "TAGSET:adapters-optimizations:imports"
                    allow: ["/imports.py"]
                  - condition: "TAGSET:adapters-optimizations:literals"
                    allow: ["/literals*.py"]
                  - condition: "TAGSET:adapters-optimizations:trivial"
                    allow: ["/trivial.py"]
              go:
                mode: allow
                allow:
                  - "/__init__.py"
                  - "/adapter.py"
                when:
                  - condition: "TAGSET:adapters-optimizations:function-bodies OR TAGSET:adapters-optimizations:public-api"
                    allow: ["/code_profiles.py"]
                  - condition: "TAGSET:adapters-optimizations:comments"
                    allow: ["/comments.py"]
                  - condition: "TAGSET:adapters-optimizations:imports"
                    allow: ["/imports.py"]
                  - condition: "TAGSET:adapters-optimizations:literals"
                    allow: ["/literals*.py"]
                  - condition: "TAGSET:adapters-optimizations:trivial"
                    allow: ["/trivial.py"]
              rust:
                mode: allow
                allow:
                  - "/__init__.py"
                  - "/adapter.py"
                when:
                  - condition: "TAGSET:adapters-optimizations:function-bodies OR TAGSET:adapters-optimizations:public-api"
                    allow: ["/code_profiles.py"]
                  - condition: "TAGSET:adapters-optimizations:comments"
                    allow: ["/comments.py"]
                  - condition: "TAGSET:adapters-optimizations:imports"
                    allow: ["/imports.py"]
                  - condition: "TAGSET:adapters-optimizations:literals"
                    allow: ["/literals*.py"]
                  - condition: "TAGSET:adapters-optimizations:trivial"
                    allow: ["/trivial.py"]
              scala:
                mode: allow
                allow:
                  - "/__init__.py"
                  - "/adapter.py"
                when:
                  - condition: "TAGSET:adapters-optimizations:function-bodies OR TAGSET:adapters-optimizations:public-api"
                    allow: ["/code_profiles.py"]
                  - condition: "TAGSET:adapters-optimizations:comments"
                    allow: ["/comments.py"]
                  - condition: "TAGSET:adapters-optimizations:imports"
                    allow: ["/imports.py"]
                  - condition: "TAGSET:adapters-optimizations:literals"
                    allow: ["/literals*.py"]
                  - condition: "TAGSET:adapters-optimizations:trivial"
                    allow: ["/trivial.py"]

tests:
  extends: ["tags"]
  extensions: [".py", ".ts", ".kt", ".js", ".java", ".go", ".rs", ".scala",
               ".c", ".h", ".cpp", ".hpp", ".cc", ".hh", ".hxx", ".cxx",
               ".sh"]
  filters:
    mode: allow
    allow:
      - "/tests/"
    when:
      - condition: "tag:tests-infra"
        allow:
          - "/scripts/test_adapters.sh"
    children:
      tests:
        mode: allow
        allow:
          - "/adapters/"
        children:
          adapters:
            mode: allow
            allow:
              - "/conftest.py"
            when:
              - condition: "tag:tests-infra"
                allow:
                  - "/golden_utils.py"
              - condition: "TAGSET:adapters-optimizations:core"
                allow:
                  - "/test_placeholders.py"
                  - "/test_tree_sitter_document.py"
              - condition: "TAGSET:language:python"
                allow: ["/python/"]
              - condition: "TAGSET:language:typescript"
                allow: ["/typescript/"]
              - condition: "TAGSET:language:kotlin"
                allow: ["/kotlin/"]
              - condition: "TAGSET:language:javascript"
                allow: ["/javascript/"]
              - condition: "TAGSET:language:java"
                allow: ["/java/"]
              - condition: "TAGSET:language:c"
                allow: ["/c/"]
              - condition: "TAGSET:language:cpp"
                allow: ["/cpp/"]
              - condition: "TAGSET:language:go"
                allow: ["/go/"]
              - condition: "TAGSET:language:rust"
                allow: ["/rust/"]
              - condition: "TAGSET:language:scala"
                allow: ["/scala/"]
            children:
              python:
                mode: allow
                allow: ["/conftest.py", "/utils.py"]
                when:
                  - condition: "TAGSET:adapters-optimizations:function-bodies"
                    allow: ["/test_function_bodies.py", "/goldens/do/function_bodies.py"]
                  - condition: "TAGSET:adapters-optimizations:comments"
                    allow: ["/test_comments.py", "/goldens/do/comments.py"]
                  - condition: "TAGSET:adapters-optimizations:literals"
                    allow: ["/test_literals.py", "test_literal_comment_context.py", "test_literals_indentation.py", "test_literal_sets.py", "/goldens/do/literals.py"]
                  - condition: "TAGSET:adapters-optimizations:imports"
                    allow: ["/test_imports.py", "/goldens/do/imports.py"]
                  - condition: "TAGSET:adapters-optimizations:public-api"
                    allow: ["/test_public_api.py", "/goldens/do/public_api.py"]
                  - condition: "TAGSET:adapters-optimizations:trivial"
                    allow: ["/test_trivial_files.py", "/goldens/do/*trivial*.py"]
                  - condition: "TAGSET:adapters-optimizations:budget"
                    allow: ["/test_budget.py", "/goldens/do/budget_complex.py"]
              typescript:
                mode: allow
                allow: ["/conftest.py", "/utils.py"]
                when:
                  - condition: "TAGSET:adapters-optimizations:function-bodies"
                    allow: ["/test_function_bodies.py", "/goldens/do/function_bodies.ts"]
                  - condition: "TAGSET:adapters-optimizations:comments"
                    allow: ["/test_comments.py", "/goldens/do/comments.ts"]
                  - condition: "TAGSET:adapters-optimizations:literals"
                    allow: ["/test_literals.py", "test_literal_comment_context.py", "test_literals_indentation.py", "/goldens/do/literals.ts"]
                  - condition: "TAGSET:adapters-optimizations:imports"
                    allow: ["/test_imports.py", "/goldens/do/imports.ts"]
                  - condition: "TAGSET:adapters-optimizations:public-api"
                    allow: ["/test_public_api.py", "/goldens/do/public_api.ts"]
                  - condition: "TAGSET:adapters-optimizations:trivial"
                    allow: ["/test_trivial_files.py", "/goldens/do/*trivial*.ts"]
                  - condition: "TAGSET:adapters-optimizations:budget"
                    allow: ["/test_budget.py", "/goldens/do/budget_complex.ts"]
              kotlin:
                mode: allow
                allow: ["/conftest.py", "/utils.py"]
                when:
                  - condition: "TAGSET:adapters-optimizations:function-bodies"
                    allow: ["/test_function_bodies.py", "/goldens/do/function_bodies.kt"]
                  - condition: "TAGSET:adapters-optimizations:comments"
                    allow: ["/test_comments.py", "/goldens/do/comments.kt"]
                  - condition: "TAGSET:adapters-optimizations:literals"
                    allow: ["/test_literals.py", "test_literal_comment_context.py", "test_literals_indentation.py", "/goldens/do/literals.kt"]
                  - condition: "TAGSET:adapters-optimizations:imports"
                    allow: ["/test_imports.py", "/goldens/do/imports.kt"]
                  - condition: "TAGSET:adapters-optimizations:public-api"
                    allow: ["/test_public_api.py", "/goldens/do/public_api.kt"]
                  - condition: "TAGSET:adapters-optimizations:trivial"
                    allow: ["/test_trivial_files.py", "/goldens/do/*trivial*.kt"]
                  - condition: "TAGSET:adapters-optimizations:budget"
                    allow: ["/test_budget.py", "/goldens/do/budget_complex.kt"]
              javascript:
                mode: allow
                allow: ["/conftest.py", "/utils.py"]
                when:
                  - condition: "TAGSET:adapters-optimizations:function-bodies"
                    allow: ["/test_function_bodies.py", "/goldens/do/function_bodies.js"]
                  - condition: "TAGSET:adapters-optimizations:comments"
                    allow: ["/test_comments.py", "/goldens/do/comments.js"]
                  - condition: "TAGSET:adapters-optimizations:literals"
                    allow: ["/test_literals.py", "test_literal_comment_context.py", "test_literals_indentation.py", "/goldens/do/literals.js"]
                  - condition: "TAGSET:adapters-optimizations:imports"
                    allow: ["/test_imports.py", "/goldens/do/imports.js"]
                  - condition: "TAGSET:adapters-optimizations:public-api"
                    allow: ["/test_public_api.py", "/goldens/do/public_api.js"]
                  - condition: "TAGSET:adapters-optimizations:trivial"
                    allow: ["/test_trivial_files.py", "/goldens/do/*trivial*.js"]
                  - condition: "TAGSET:adapters-optimizations:budget"
                    allow: ["/test_budget.py", "/goldens/do/budget_complex.js"]
              java:
                mode: allow
                allow: ["/conftest.py", "/utils.py"]
                when:
                  - condition: "TAGSET:adapters-optimizations:function-bodies"
                    allow: ["/test_function_bodies.py", "/goldens/do/function_bodies.java"]
                  - condition: "TAGSET:adapters-optimizations:comments"
                    allow: ["/test_comments.py", "/goldens/do/comments.java"]
                  - condition: "TAGSET:adapters-optimizations:literals"
                    allow: ["/test_literals.py", "test_literal_comment_context.py", "test_literals_indentation.py", "/goldens/do/literals.java"]
                  - condition: "TAGSET:adapters-optimizations:imports"
                    allow: ["/test_imports.py", "/goldens/do/imports.java"]
                  - condition: "TAGSET:adapters-optimizations:public-api"
                    allow: ["/test_public_api.py", "/goldens/do/public_api.java"]
                  - condition: "TAGSET:adapters-optimizations:trivial"
                    allow: ["/test_trivial_files.py", "/goldens/do/*trivial*.java"]
                  - condition: "TAGSET:adapters-optimizations:budget"
                    allow: ["/test_budget.py", "/goldens/do/budget_complex.java"]
              c:
                mode: allow
                allow:
                  - "/conftest.py"
                  - "/utils.py"
                  - "/test_header_vs_impl.py"
                when:
                  - condition: "TAGSET:adapters-optimizations:function-bodies"
                    allow: ["/test_function_bodies.py", "/goldens/do/function_bodies.c"]
                  - condition: "TAGSET:adapters-optimizations:comments"
                    allow: ["/test_comments.py", "/goldens/do/comments.c"]
                  - condition: "TAGSET:adapters-optimizations:literals"
                    allow: ["/test_literals.py", "/goldens/do/literals.c"]
                  - condition: "TAGSET:adapters-optimizations:imports"
                    allow: ["/test_imports.py", "/goldens/do/imports.c"]
                  - condition: "TAGSET:adapters-optimizations:public-api"
                    allow: ["/test_public_api.py", "/goldens/do/public_api.c"]
                  - condition: "TAGSET:adapters-optimizations:trivial"
                    allow: ["/test_trivial_files.py", "/goldens/do/*trivial*.c", "/goldens/do/*trivial*.h"]
                  - condition: "TAGSET:adapters-optimizations:budget"
                    allow: ["/test_budget.py", "/goldens/do/budget_complex.c"]
              cpp:
                mode: allow
                allow:
                  - "/conftest.py"
                  - "/utils.py"
                  - "/test_header_vs_impl.py"
                when:
                  - condition: "TAGSET:adapters-optimizations:function-bodies"
                    allow: ["/test_function_bodies.py", "/goldens/do/function_bodies.cpp"]
                  - condition: "TAGSET:adapters-optimizations:comments"
                    allow: ["/test_comments.py", "/goldens/do/comments.cpp"]
                  - condition: "TAGSET:adapters-optimizations:literals"
                    allow: ["/test_literals.py", "/goldens/do/literals.cpp"]
                  - condition: "TAGSET:adapters-optimizations:imports"
                    allow: ["/test_imports.py", "/goldens/do/imports.cpp"]
                  - condition: "TAGSET:adapters-optimizations:public-api"
                    allow: ["/test_public_api.py", "/goldens/do/public_api.cpp"]
                  - condition: "TAGSET:adapters-optimizations:trivial"
                    allow: ["/test_trivial_files.py", "/goldens/do/*trivial*.cpp", "/goldens/do/*trivial*.hpp"]
                  - condition: "TAGSET:adapters-optimizations:budget"
                    allow: ["/test_budget.py", "/goldens/do/budget_complex.cpp"]
              go:
                mode: allow
                allow:
                  - "/conftest.py"
                  - "/utils.py"
                when:
                  - condition: "TAGSET:adapters-optimizations:function-bodies"
                    allow: ["/test_function_bodies.py", "/goldens/do/function_bodies.go"]
                  - condition: "TAGSET:adapters-optimizations:comments"
                    allow: ["/test_comments.py", "/goldens/do/comments.go"]
                  - condition: "TAGSET:adapters-optimizations:literals"
                    allow: ["/test_literals.py", "/goldens/do/literals.go"]
                  - condition: "TAGSET:adapters-optimizations:imports"
                    allow: ["/test_imports.py", "/goldens/do/imports.go"]
                  - condition: "TAGSET:adapters-optimizations:public-api"
                    allow: ["/test_public_api.py", "/goldens/do/public_api.go"]
                  - condition: "TAGSET:adapters-optimizations:trivial"
                    allow: ["/test_trivial_files.py", "/goldens/do/*trivial*.go"]
                  - condition: "TAGSET:adapters-optimizations:budget"
                    allow: ["/test_budget.py", "/goldens/do/budget_complex.go"]
              rust:
                mode: allow
                allow:
                  - "/conftest.py"
                  - "/utils.py"
                when:
                  - condition: "TAGSET:adapters-optimizations:function-bodies"
                    allow: ["/test_function_bodies.py", "/goldens/do/function_bodies.rs"]
                  - condition: "TAGSET:adapters-optimizations:comments"
                    allow: ["/test_comments.py", "/goldens/do/comments.rs"]
                  - condition: "TAGSET:adapters-optimizations:literals"
                    allow: ["/test_literals.py", "/goldens/do/literals.rs"]
                  - condition: "TAGSET:adapters-optimizations:imports"
                    allow: ["/test_imports.py", "/goldens/do/imports.rs"]
                  - condition: "TAGSET:adapters-optimizations:public-api"
                    allow: ["/test_public_api.py", "/goldens/do/public_api.rs"]
                  - condition: "TAGSET:adapters-optimizations:trivial"
                    allow: ["/test_trivial_files.py", "/goldens/do/*trivial*.rs"]
                  - condition: "TAGSET:adapters-optimizations:budget"
                    allow: ["/test_budget.py", "/goldens/do/budget_complex.rs"]
              scala:
                mode: allow
                allow:
                  - "/conftest.py"
                  - "/utils.py"
                when:
                  - condition: "TAGSET:adapters-optimizations:function-bodies"
                    allow: ["/test_function_bodies.py", "/goldens/do/function_bodies.scala"]
                  - condition: "TAGSET:adapters-optimizations:comments"
                    allow: ["/test_comments.py", "/goldens/do/comments.scala"]
                  - condition: "TAGSET:adapters-optimizations:literals"
                    allow: ["/test_literals.py", "/goldens/do/literals.scala"]
                  - condition: "TAGSET:adapters-optimizations:imports"
                    allow: ["/test_imports.py", "/goldens/do/imports.scala"]
                  - condition: "TAGSET:adapters-optimizations:public-api"
                    allow: ["/test_public_api.py", "/goldens/do/public_api.scala"]
                  - condition: "TAGSET:adapters-optimizations:trivial"
                    allow: ["/test_trivial_files.py", "/goldens/do/*trivial*.scala"]
                  - condition: "TAGSET:adapters-optimizations:budget"
                    allow: ["/test_budget.py", "/goldens/do/budget_complex.scala"]

  tag-sets:
    code-type:
      title: "Code Type"
      tags:
        tests-infra:
          title: "Test infrastructure"
