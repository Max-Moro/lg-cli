src:
  extensions: [".py", ".toml"]
  filters:
    mode: allow
    allow:
      - "/pyproject.toml"
      - "/lg/"
    children:
      lg:
        mode: allow
        allow:
          - "/cli.py"
          - "/engine.py"
          - "/types.py"
          - "/run_context.py"
          - "/template/context.py"
          - "/section_processor.py"
          - "/config/"
          - "/adapters/"
        children:
          config:
            mode: allow
            allow:
              - "/load.py"
              - "/model.py"
          adapters:
            mode: allow
            allow:
              - "/__init__.py"
              - "/registry.py"
              - "/base.py"
              - "/processor.py"
              - "/context.py"
              - "/code_model.py"
              - "/code_base.py"
#              - "/optimizations/"
#            when:
#              - condition: "TAGSET:adapters-optimizations:core"
#                allow:
#                  - "/tree_sitter_support.py"
#                  - "/range_edits.py"
#                  - "/placeholders.py"
#                  - "/metrics.py"
#              - condition: "TAGSET:adapters-optimizations:budget"
#                allow: ["/budget.py"]
#              - condition: "TAGSET:adapters-optimizations:function-bodies OR TAGSET:adapters-optimizations:public-api"
#                allow: ["/code_analysis.py"]
#              - condition: "TAGSET:language:python"
#                allow: ["/python/"]
#              - condition: "TAGSET:language:kotlin"
#                allow: ["/kotlin/"]
#              - condition: "TAGSET:language:typescript"
#                allow: ["/typescript/"]
#              - condition: "TAGSET:language:javascript"
#                allow: ["/javascript.py"]
#              - condition: "TAGSET:language:java"
#                allow: ["/java.py"]
#              - condition: "TAGSET:language:cpp"
#                allow: ["/cpp.py"]
#              - condition: "TAGSET:language:scala"
#                allow: ["/scala.py"]
#            children:
#              optimizations:
#                mode: allow
#                when:
#                  - condition: "TAGSET:adapters-optimizations:function-bodies"
#                    allow: ["/function_bodies.py"]
#                  - condition: "TAGSET:adapters-optimizations:comments"
#                    allow: ["/comments.py"]
#                  - condition: "TAGSET:adapters-optimizations:literals"
#                    allow: ["/literals.py"]
#                  - condition: "TAGSET:adapters-optimizations:imports"
#                    allow: ["/imports.py"]
#                  - condition: "TAGSET:adapters-optimizations:public-api"
#                    allow: ["/public_api.py"]
#              python:
#                mode: allow
#                allow:
#                  - "/__init__.py"
#                  - "/adapter.py"
#                  - "/queries.py"
#                  - "/file_heuristics.py"
#                when:
#                  - condition: "TAGSET:adapters-optimizations:function-bodies"
#                    allow: ["/function_bodies.py", "/code_analysis.py"]
#                  - condition: "TAGSET:adapters-optimizations:comments"
#                    allow: ["/comments.py"]
#                  - condition: "TAGSET:adapters-optimizations:imports"
#                    allow: ["/imports.py"]
#                  - condition: "TAGSET:adapters-optimizations:public-api"
#                    allow: ["/code_analysis.py"]
#              typescript:
#                mode: allow
#                allow:
#                  - "/__init__.py"
#                  - "/adapter.py"
#                  - "/queries.py"
#                  - "/file_heuristics.py"
#                when:
#                  - condition: "TAGSET:adapters-optimizations:function-bodies"
#                    allow: ["/code_analysis.py"]
#                  - condition: "TAGSET:adapters-optimizations:imports"
#                    allow: ["/imports.py"]
#                  - condition: "TAGSET:adapters-optimizations:public-api"
#                    allow: ["/code_analysis.py"]
#              kotlin:
#                mode: allow
#                allow:
#                  - "/__init__.py"
#                  - "/adapter.py"
#                  - "/queries.py"
#                  - "/file_heuristics.py"
#                when:
#                  - condition: "TAGSET:adapters-optimizations:function-bodies"
#                    allow: ["/code_analysis.py"]
#                  - condition: "TAGSET:adapters-optimizations:imports"
#                    allow: ["/imports.py"]
#                  - condition: "TAGSET:adapters-optimizations:public-api"
#                    allow: ["/code_analysis.py"]

tests:
  extensions: [".py", ".ts", ".kt", ".js"]
  filters:
    mode: allow
    allow:
      - "/tests/"
    children:
      tests:
        mode: allow
        allow:
          - "/adapters/"
        children:
          adapters:
            mode: allow
            allow:
              - "/conftest.py"
            when:
              - condition: "tag:tests-infra"
                allow:
                  - "/golden_utils.py"
#              - condition: "TAGSET:adapters-optimizations:core"
#                allow:
#                  - "/test_placeholders.py"
#                  - "/test_tree_sitter_document.py"
              - condition: "TAGSET:language:python"
                allow: ["/python/"]
              - condition: "TAGSET:language:typescript"
                allow: ["/typescript/"]
              - condition: "TAGSET:language:kotlin"
                allow: ["/kotlin/"]
              - condition: "TAGSET:language:javascript"
                allow: ["/javascript/"]
              - condition: "TAGSET:language:java"
                allow: ["/java/"]
              - condition: "TAGSET:language:c"
                allow: ["/c/"]
              - condition: "TAGSET:language:cpp"
                allow: ["/cpp/"]
              - condition: "TAGSET:language:go"
                allow: ["/go/"]
              - condition: "TAGSET:language:rust"
                allow: ["/rust/"]
              - condition: "TAGSET:language:scala"
                allow: ["/scala/"]
            children:
              python:
                mode: allow
                allow: ["/conftest.py", "/utils.py"]
                when:
                  - condition: "TAGSET:adapters-optimizations:function-bodies"
                    allow: ["/test_function_bodies.py", "/goldens/do/function_bodies.py"]
                  - condition: "TAGSET:adapters-optimizations:comments"
                    allow: ["/test_comments.py", "/goldens/do/comments.py"]
                  - condition: "TAGSET:adapters-optimizations:literals"
                    allow: ["/test_literals.py", "test_literal_comment_context.py", "test_literals_indentation.py", "test_literal_sets.py", "/goldens/do/literals.py"]
                  - condition: "TAGSET:adapters-optimizations:imports"
                    allow: ["/test_imports.py", "/goldens/do/imports.py"]
                  - condition: "TAGSET:adapters-optimizations:public-api"
                    allow: ["/test_public_api.py", "/goldens/do/public_api.py"]
                  - condition: "TAGSET:adapters-optimizations:budget"
                    allow: ["/test_budget.py", "/goldens/do/budget_complex.py"]
              typescript:
                mode: allow
                allow: ["/conftest.py", "/utils.py"]
                when:
                  - condition: "TAGSET:adapters-optimizations:function-bodies"
                    allow: ["/test_function_bodies.py", "/goldens/do/function_bodies.ts"]
                  - condition: "TAGSET:adapters-optimizations:comments"
                    allow: ["/test_comments.py", "/goldens/do/comments.ts"]
                  - condition: "TAGSET:adapters-optimizations:literals"
                    allow: ["/test_literals.py", "test_literal_comment_context.py", "test_literals_indentation.py", "/goldens/do/literals.ts"]
                  - condition: "TAGSET:adapters-optimizations:imports"
                    allow: ["/test_imports.py", "/goldens/do/imports.ts"]
                  - condition: "TAGSET:adapters-optimizations:public-api"
                    allow: ["/test_public_api.py", "/goldens/do/public_api.ts"]
                  - condition: "TAGSET:adapters-optimizations:budget"
                    allow: ["/test_budget.py", "/goldens/do/budget_complex.ts"]
              kotlin:
                mode: allow
                allow: ["/conftest.py", "/utils.py"]
                when:
                  - condition: "TAGSET:adapters-optimizations:function-bodies"
                    allow: ["/test_function_bodies.py", "/goldens/do/function_bodies.kt"]
                  - condition: "TAGSET:adapters-optimizations:comments"
                    allow: ["/test_comments.py", "/goldens/do/comments.kt"]
                  - condition: "TAGSET:adapters-optimizations:literals"
                    allow: ["/test_literals.py", "test_literal_comment_context.py", "test_literals_indentation.py", "/goldens/do/literals.kt"]
                  - condition: "TAGSET:adapters-optimizations:imports"
                    allow: ["/test_imports.py", "/goldens/do/imports.kt"]
                  - condition: "TAGSET:adapters-optimizations:public-api"
                    allow: ["/test_public_api.py", "/goldens/do/public_api.kt"]
                  - condition: "TAGSET:adapters-optimizations:budget"
                    allow: ["/test_budget.py", "/goldens/do/budget_complex.kt"]
              javascript:
                mode: allow
                allow: ["/conftest.py", "/utils.py"]
                when:
                  - condition: "TAGSET:adapters-optimizations:function-bodies"
                    allow: ["/test_function_bodies.py", "/goldens/do/function_bodies.js"]
                  - condition: "TAGSET:adapters-optimizations:comments"
                    allow: ["/test_comments.py", "/goldens/do/comments.js"]
                  - condition: "TAGSET:adapters-optimizations:literals"
                    allow: ["/test_literals.py", "test_literal_comment_context.py", "test_literals_indentation.py", "/goldens/do/literals.js"]
                  - condition: "TAGSET:adapters-optimizations:imports"
                    allow: ["/test_imports.py", "/goldens/do/imports.js"]
                  - condition: "TAGSET:adapters-optimizations:public-api"
                    allow: ["/test_public_api.py", "/goldens/do/public_api.js"]
                  - condition: "TAGSET:adapters-optimizations:budget"
                    allow: ["/test_budget.py", "/goldens/do/budget_complex.js"]
